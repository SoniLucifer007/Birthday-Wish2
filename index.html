<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Birthday Wish For You</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        /* Global & Custom Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&display=swap');
        @font-face {
            font-family: 'Satoshi';
            src: url('https://d33wubrfki0l68.cloudfront.net/603405c1d68305c0d54c76b7e096f9a0670d8a59/4f6d1/assets/fonts/Satoshi-Variable.woff2') format('woff2');
            font-weight: 300 900;
            font-display: swap;
            font-style: normal;
        }

        /* Core Design System & Global Styles */
        body {
            background-color: #0c0a09; /* Dark mode base */
            font-family: 'Satoshi', sans-serif;
            color: #d1d5db; /* Light gray body text */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* Layer 1: Animated Aurora Gradient */
        #aurora-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; /* Below content but above 3D hearts if needed */
            overflow: hidden;
            background: radial-gradient(circle at 10% 90%, hsla(333,70%,55%,.4), transparent 70%),
                        radial-gradient(circle at 70% 20%, hsla(282, 82%, 54%, .3), transparent 70%),
                        radial-gradient(circle at 40% 60%, hsla(210, 89%, 60%, .3), transparent 70%),
                        radial-gradient(circle at 90% 50%, hsla(35, 90%, 60%, .3), transparent 70%);
            background-size: 300% 300%;
            animation: aurora-flow 60s ease-in-out infinite alternate;
        }

        @keyframes aurora-flow {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        /* Layer 2: Three.js hearts canvas */
        #threejs-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* Main Content Cards (Glassmorphism) */
        .glass-card {
            background-color: rgba(12, 10, 9, 0.7); /* Very dark semi-transparent */
            backdrop-filter: blur(20px); /* Heavy frosted glass effect */
            -webkit-backdrop-filter: blur(20px); /* Safari support */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle white border */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), /* Soft floating shadow */
                        0 0 40px rgba(255, 100, 150, 0.1); /* Subtle glow effect */
            transform: perspective(1000px); /* Needed for 3D transforms */
        }

        /* Typography: Headings (Text Gradient) */
        .text-gradient-heading {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            background: linear-gradient(120deg, #ffc0cb, #ffffff, #ff69b4); /* Light pinks and white */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        /* Buttons */
        .pill-button {
            background: linear-gradient(90deg, #ff69b4, #ff007f, #ff4500); /* Vibrant pink-to-red gradient */
            color: white;
            font-weight: bold;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 9999px; /* Pill shape */
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.6); /* Soft glow */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            z-index: 10;
        }
        .pill-button:hover {
            transform: translateY(-3px) scale(1.05); /* Lift and scale up */
            box-shadow: 0 5px 30px rgba(255, 105, 180, 0.8), 0 0 50px rgba(255, 0, 127, 0.9); /* Intense glow */
        }
        .pill-button:active {
            transform: translateY(1px) scale(1.01); /* Pressed down animation */
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.4);
        }

        /* Step 1: Pulsating Heart Icon */
        #heart-icon {
            font-size: 4rem;
            color: #ff69b4;
            animation: pulse-glow 2s infinite alternate;
            text-shadow: 0 0 15px #ff69b4, 0 0 30px #ff69b4;
        }

        @keyframes pulse-glow {
            from { transform: scale(1); opacity: 0.8; }
            to { transform: scale(1.05); opacity: 1; }
        }

        /* Progress Bar Styles */
        #progress-track {
            background-color: rgba(12, 10, 9, 0.6);
            backdrop-filter: blur(5px);
            border-radius: 9999px;
            height: 8px;
            width: 90%;
            max-width: 400px;
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
        }
        #progress-bar {
            background: linear-gradient(90deg, #ffc0cb, #ff007f, #ff4500);
            height: 100%;
            width: 0%;
            border-radius: 9999px;
            transition: width 0.6s ease-in-out;
        }

        /* Polaroid Style */
        .polaroid-frame {
            background-color: #f0f0f0;
            padding: 15px 15px 50px 15px; /* Larger bottom for caption */
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            max-width: 90%;
            margin: 0 auto 1rem;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
        }
        .polaroid-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .polaroid-caption {
            color: #333;
            text-align: center;
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            font-weight: 700;
            padding-top: 10px;
        }
        
        /* Bento Grid Specific Styles */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            width: 100%;
        }
        .bento-card {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 12px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.1);
        }
        .bento-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.3);
        }
        .col-span-2 { grid-column: span 2 / span 2; }
        .col-span-4 { grid-column: span 4 / span 4; }

        /* Mobile Adjustments for Bento Grid */
        @media (max-width: 640px) {
            .bento-grid {
                grid-template-columns: 1fr;
            }
            .col-span-2, .col-span-4 { grid-column: auto; }
            .polaroid-frame {
                transform: rotateZ(-5deg) !important; /* Static tilt for mobile */
                max-width: 250px;
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 relative">

    <div id="aurora-background"></div>

    <canvas id="threejs-canvas"></canvas>

    <div id="progress-track">
        <div id="progress-bar"></div>
    </div>

    <main class="w-full max-w-xl md:max-w-2xl lg:max-w-3xl">
        <div id="steps-container" class="relative w-full h-full">
            </div>
    </main>

    <script>
        const STEPS = [
            {
                id: 1,
                content: `
                    <div class="flex flex-col items-center space-y-6">
                        <div id="heart-icon">‚ù§Ô∏è</div>
                        <h1 class="text-5xl md:text-6xl text-gradient-heading">Hey Beautiful,</h1>
                        <p class="text-center text-lg md:text-xl max-w-sm">I built a little world for you, just to bring a smile to your face on your special day.</p>
                        <button class="pill-button" data-action="next">Let's Begin</button>
                    </div>
                `
            },
            {
                id: 2,
                content: `
                    <div class="flex flex-col items-center space-y-6">
                        <div class="text-5xl md:text-6xl">üéâ</div>
                        <h2 class="text-4xl md:text-5xl text-gradient-heading">Happy Birthday!</h2>
                        <p class="text-center text-lg md:text-xl max-w-lg">Another year of you making the world brighter. Your existence is a gift, and I'm so lucky to witness it.</p>
                        <button class="pill-button" data-action="next">There's more...</button>
                    </div>
                `
            },
            {
                id: 3,
                content: `
                    <div class="flex flex-col items-center space-y-6 w-full">
                        <h2 class="text-4xl md:text-5xl text-gradient-heading">A Few Things I Adore About You</h2>
                        <div class="bento-grid">
                            <div class="bento-card col-span-2">
                                <h3 class="text-xl font-bold text-pink-300 mb-2">‚ú® Your Unmatched Kindness</h3>
                                <p class="text-sm">The genuine warmth you show to everyone is something truly rare and beautiful.</p>
                            </div>
                            <div class="bento-card">
                                <h3 class="text-xl font-bold text-pink-300 mb-2">üòä That Smile</h3>
                                <p class="text-sm">It's a work of art.</p>
                            </div>
                            <div class="bento-card col-span-4">
                                <h3 class="text-xl font-bold text-pink-300 mb-2">üåü Your Radiant Spirit</h3>
                                <p class="text-sm">Your passion for life is infectious. Being around you makes everything feel more exciting and possible.</p>
                            </div>
                        </div>
                        <button class="pill-button mt-4" data-action="next">Remember this?</button>
                    </div>
                `
            },
            {
                id: 4,
                content: `
                    <div class="flex flex-col items-center space-y-6">
                        <h2 class="text-4xl md:text-5xl text-gradient-heading">That One Time...</h2>
                        <div id="polaroid" class="polaroid-frame rotate-z-5 w-fit max-w-xs transition-transform duration-300 ease-out">
                            <img src="f1.jpeg" alt="Shared memory" class="polaroid-image">
                            <div class="polaroid-caption">Our favorite memory.</div>
                        </div>
                        <p class="text-center text-lg md:text-xl max-w-sm">Every moment with you feels like a scene from a movie I'd watch on repeat.</p>
                        <button class="pill-button" data-action="next">One last thing...</button>
                    </div>
                `
            },
            {
                id: 5,
                content: `
                    <div class="flex flex-col items-center space-y-6">
                        <div class="text-5xl md:text-6xl">üéÇ</div>
                        <h2 class="text-4xl md:text-5xl text-gradient-heading">My Wish For You</h2>
                        <p class="text-center text-lg md:text-xl max-w-lg">May the next year bring you all the love, success, and pure happiness you so rightfully deserve. May your dreams soar higher than ever.</p>
                        <p id="final-message" class="text-3xl md:text-4xl text-gradient-heading opacity-0 -translate-y-4" style="font-weight: 700;">Happy Birthday, my Love! ‚ù§Ô∏è</p>
                        <button id="celebrate-button" class="pill-button" data-action="finale">Celebrate!</button>
                    </div>
                `
            }
        ];

        let currentStep = 1;
        const stepsContainer = document.getElementById('steps-container');
        const progressBar = document.getElementById('progress-bar');
        const heartObjects = []; // Array to hold Three.js heart objects

        // --- Core Functions ---

        /**
         * Loads and displays a specific step with animation.
         * @param {number} stepIndex - The index of the step to load (1-based).
         */
        function loadStep(stepIndex) {
            const stepData = STEPS.find(s => s.id === stepIndex);
            if (!stepData) return;

            const newStepElement = document.createElement('div');
            newStepElement.id = `step-${stepIndex}`;
            newStepElement.className = 'glass-card p-8 md:p-12 rounded-2xl w-full mx-auto absolute inset-0 opacity-0 scale-95';
            newStepElement.innerHTML = stepData.content;
            stepsContainer.appendChild(newStepElement);

            // GSAP animation for the new card
            gsap.timeline()
                .to(newStepElement, {
                    opacity: 1,
                    scale: 1,
                    duration: 0.8,
                    ease: "power3.out",
                    onComplete: () => {
                        // Attach event listeners for the new button
                        newStepElement.querySelectorAll('[data-action="next"]').forEach(button => {
                            button.addEventListener('click', () => transitionToNextStep(newStepElement));
                        });
                        // Attach finale event listener for the last button
                        if (stepIndex === STEPS.length) {
                            document.getElementById('celebrate-button').addEventListener('click', triggerFinale);
                        }
                    }
                })
                .from(newStepElement.children, {
                    opacity: 0,
                    y: 20,
                    duration: 0.5,
                    stagger: 0.1,
                    ease: "power2.out"
                }, "-=0.5"); // Stagger internal elements

            updateProgressBar(stepIndex);
            currentStep = stepIndex;

            // Step 4: Add interaction for the Polaroid
            if (stepIndex === 4) {
                setupPolaroidInteraction(document.getElementById('polaroid'));
            }
        }

        /**
         * Transitions from the current step to the next.
         * @param {HTMLElement} currentElement - The DOM element of the step to transition out.
         */
        function transitionToNextStep(currentElement) {
            if (currentStep >= STEPS.length) return; // Already on the final step

            // GSAP animation for the current card fading out
            gsap.to(currentElement, {
                opacity: 0,
                scale: 0.9,
                duration: 0.4,
                ease: "power2.in",
                onComplete: () => {
                    stepsContainer.removeChild(currentElement);
                    loadStep(currentStep + 1);
                }
            });
        }

        /**
         * Updates the progress bar visually.
         * @param {number} step - The current step number (1-based).
         */
        function updateProgressBar(step) {
            const progress = (step / STEPS.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // --- Step 4 Specific Interaction ---

        /**
         * Sets up the parallax and 3D tilt interaction for the polaroid.
         * @param {HTMLElement} polaroidElement - The polaroid DOM element.
         */
        function setupPolaroidInteraction(polaroidElement) {
            const card = document.querySelector('.glass-card');
            if (!card) return;

            card.addEventListener('mousemove', (e) => {
                if (window.innerWidth <= 640) return; // Skip for mobile

                const rect = card.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                const offsetX = (e.clientX - centerX) / (rect.width / 2); // -1 to 1
                const offsetY = (e.clientY - centerY) / (rect.height / 2); // -1 to 1

                // Subtle tilt
                const rotateX = -offsetY * 5; // Max 5 degrees
                const rotateY = offsetX * 5; // Max 5 degrees

                // Apply to polaroid
                polaroidElement.style.transform = `
                    rotateX(${rotateX}deg) 
                    rotateY(${rotateY}deg) 
                    translateZ(10px) 
                    rotateZ(-5deg)
                `;
            });

            card.addEventListener('mouseleave', () => {
                 if (window.innerWidth <= 640) return;
                 // Return to initial slightly tilted state
                polaroidElement.style.transform = 'rotateX(0deg) rotateY(0deg) translateZ(0) rotateZ(-5deg)';
            });
        }


        // --- Grand Finale Sequence ---

        /**
         * Triggers the grand finale animations.
         */
        function triggerFinale() {
            const celebrateButton = document.getElementById('celebrate-button');
            const finalMessage = document.getElementById('final-message');

            if (celebrateButton) {
                celebrateButton.disabled = true;
                // 1. Button Fade Out
                gsap.to(celebrateButton, { opacity: 0, scale: 0.9, duration: 0.4 });
            }

            // 2. Final Message Fade In
            gsap.to(finalMessage, { opacity: 1, y: 0, duration: 1.5, ease: "elastic.out(1, 0.3)", delay: 0.5 });

            // 3. Confetti Explosion
            startConfettiSequence();

            // 4. Three.js Hearts Finale
            animateHeartsFinale();
        }

        /**
         * Manages the multi-layered confetti sequence.
         */
        function startConfettiSequence() {
            // Powerful bursts from bottom corners
            const burst = (originX) => {
                confetti({
                    particleCount: 100,
                    startVelocity: 50,
                    spread: 80,
                    origin: { x: originX, y: 1 },
                    colors: ['#ffc0cb', '#ff69b4', '#ff007f', '#ff4500', '#ffffff']
                });
            };

            burst(0.1); // Left corner
            setTimeout(() => burst(0.9), 300); // Right corner

            // Continuous gentle shower (standard and emoji confetti)
            const duration = 5 * 1000;
            const end = Date.now() + duration;

            (function frame() {
                // Standard confetti
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#ffc0cb', '#ff007f', '#ffffff']
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#ff4500', '#ff69b4', '#ffffff']
                });

                // Emoji confetti (less frequent)
                if (Math.random() < 0.2) {
                     confetti({
                        particleCount: 2,
                        angle: 90,
                        spread: 100,
                        origin: { x: Math.random() },
                        shapes: ['heart', 'star'],
                        zIndex: 1000,
                        colors: ['#ff007f', '#ffc0cb']
                    });
                     confetti({
                        particleCount: 1,
                        angle: 90,
                        spread: 50,
                        origin: { x: Math.random() },
                        shapes: ['emoji'],
                        zIndex: 1000,
                        // Emojis for the shape property will be a text string
                        // We use the 'texts' property for more reliable emoji confetti
                        texts: ['‚ù§Ô∏è', 'üíñ', '‚ú®'],
                        scalar: 2
                    });
                }


                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        // --- Three.js Setup for 3D Hearts ---

        let scene, camera, renderer;
        const HEART_COUNT = 20;
        const heartMaterial = new THREE.MeshPhongMaterial({
            color: 0xff69b4,
            shininess: 100,
            specular: 0xffffff
        });

        function initThreeJS() {
            const canvas = document.getElementById('threejs-canvas');
            scene = new THREE.Scene();
            
            // Set up Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 50;

            // Set up Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambientLight);
            
            const pointLight1 = new THREE.PointLight(0xffc0cb, 0.8, 100);
            pointLight1.position.set(50, 50, 50);
            scene.add(pointLight1);
            
            const pointLight2 = new THREE.PointLight(0xff007f, 0.6, 100);
            pointLight2.position.set(-50, -50, -50);
            scene.add(pointLight2);

            // Load Heart Geometry (simplified version for single-file HTML)
            const heartShape = new THREE.Shape();
            heartShape.moveTo( 25, 25 );
            heartShape.bezierCurveTo( 25, 25, 20, 0, 0, 0 );
            heartShape.bezierCurveTo( -30, 0, -30, 35, -30, 35 );
            heartShape.bezierCurveTo( -30, 55, -10, 77, 25, 95 );
            heartShape.bezierCurveTo( 60, 77, 80, 55, 80, 35 );
            heartShape.bezierCurveTo( 80, 35, 80, 0, 50, 0 );
            heartShape.bezierCurveTo( 35, 0, 25, 25, 25, 25 );

            const extrudeSettings = {
                depth: 10,
                bevelEnabled: true,
                bevelSegments: 2,
                steps: 2,
                bevelSize: 1,
                bevelThickness: 1
            };
            const heartGeometry = new THREE.ExtrudeGeometry( heartShape, extrudeSettings );
            // Adjust geometry position to center it
            heartGeometry.scale(0.08, 0.08, 0.08); // Scale down to a manageable size
            heartGeometry.center();

            // Create hearts
            for (let i = 0; i < HEART_COUNT; i++) {
                const heart = new THREE.Mesh(heartGeometry, heartMaterial);

                // Random positions in a volume
                heart.position.x = (Math.random() - 0.5) * 80;
                heart.position.y = (Math.random() - 0.5) * 60;
                heart.position.z = (Math.random() - 0.5) * 50;

                // Random rotations
                heart.rotation.x = Math.random() * Math.PI * 2;
                heart.rotation.y = Math.random() * Math.PI * 2;
                heart.rotation.z = Math.random() * Math.PI * 2;

                // Random sizes
                const scale = 0.5 + Math.random() * 0.8;
                heart.scale.set(scale, scale, scale);

                // Custom properties for animation
                heart.initialY = heart.position.y;
                heart.speed = 0.005 + Math.random() * 0.01; // Varying animation speed
                
                scene.add(heart);
                heartObjects.push(heart);
            }

            window.addEventListener('resize', onWindowResize);
            animateHearts();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animateHearts() {
            requestAnimationFrame(animateHearts);

            const time = Date.now() * 0.001;

            heartObjects.forEach((heart, index) => {
                // Subtle sine-wave floating motion
                heart.position.y = heart.initialY + Math.sin(time * heart.speed * 20 + index) * 3;
                
                // Subtle rotation
                heart.rotation.y += heart.speed * 1.5;
                heart.rotation.x += heart.speed * 0.5;
            });

            renderer.render(scene, camera);
        }

        /**
         * Final animation for Three.js hearts: swirl outwards and fade away.
         */
        function animateHeartsFinale() {
            heartObjects.forEach((heart, index) => {
                const angle = index * (Math.PI * 2 / HEART_COUNT);
                const radius = 100;
                
                // GSAP animation for final movement
                gsap.to(heart.position, {
                    x: Math.cos(angle) * radius,
                    y: heart.position.y + 100, // Float up off screen
                    z: Math.sin(angle) * radius,
                    duration: 3,
                    ease: "power2.inOut"
                });

                // Fade out (using material opacity)
                gsap.to(heart.material, {
                    opacity: 0,
                    duration: 2,
                    delay: 1, // Start fading after moving a bit
                    onComplete: () => {
                         // Clean up heart mesh
                         scene.remove(heart);
                         heart.geometry.dispose();
                         heart.material.dispose();
                    }
                });
                heart.material.transparent = true; // Enable transparency for fade out
            });
        }


        // --- Initialization ---

        window.onload = () => {
            initThreeJS();
            loadStep(1); // Start the journey
        };
    </script>

</body>
</html>
